# ğŸ¨ VISUAL ARCHITECTURE DIAGRAMS

## ğŸ“Š System Architecture Comparison

### **BEFORE (Current System - 9.3/10)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User FE   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/ai/chat
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AiController                        â”‚
â”‚  â€¢ IntentParser (rule-based)                â”‚
â”‚  â€¢ Fast-path for filters                    â”‚
â”‚  â€¢ Off-topic detection                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RecommendationServiceâ”‚    â”‚   AiService          â”‚
â”‚  â€¢ Wishlist genres   â”‚    â”‚  â€¢ OpenAI GPT-4o-miniâ”‚
â”‚  â€¢ ViewCount ranking â”‚    â”‚  â€¢ Token optimizationâ”‚
â”‚  â€¢ NO ML             â”‚    â”‚  â€¢ Generic prompt    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚
       â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MovieService  â”‚          â”‚ ChatResponse â”‚
â”‚  â€¢ DynamoDB    â”‚          â”‚  â€¢ answer    â”‚
â”‚  â€¢ 1K+ movies  â”‚          â”‚  â€¢ movies[]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ Missing:
- User behavior tracking
- Personalization
- Conversational personality
- Proactive suggestions
```

---

### **AFTER (Enhanced System - 9.8-10.0/10)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User FE   â”‚ â† Tracks events: click_movie, view_engaged
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/signals (NEW!)
       â”‚ POST /api/ai/chat
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AiController                                    â”‚
â”‚  â€¢ IntentParser (rule-based)                            â”‚
â”‚  â€¢ ProactiveSuggestionService (NEW!)                    â”‚
â”‚  â€¢ UserBehaviorService (NEW!)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                 â–¼                 â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚UserProfile   â”‚  â”‚ItemEmbedding â”‚  â”‚UserSignal    â”‚  â”‚AiService     â”‚
â”‚ (DynamoDB)   â”‚  â”‚ (DynamoDB)   â”‚  â”‚ (DynamoDB)   â”‚  â”‚ (OpenAI)     â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚â€¢ userId      â”‚  â”‚â€¢ movieId     â”‚  â”‚â€¢ userId      â”‚  â”‚â€¢ Persona ctx â”‚
â”‚â€¢ userVector  â”‚  â”‚â€¢ vector      â”‚  â”‚â€¢ timestamp   â”‚  â”‚â€¢ Proactive   â”‚
â”‚  (384-dim)   â”‚  â”‚  (384-dim)   â”‚  â”‚â€¢ eventType   â”‚  â”‚â€¢ Memory      â”‚
â”‚â€¢ topGenres   â”‚  â”‚â€¢ genres      â”‚  â”‚â€¢ metadata    â”‚  â”‚              â”‚
â”‚â€¢ priceTier   â”‚  â”‚â€¢ releaseYear â”‚  â”‚              â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                â–¼                                            â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ EmbeddingService     â”‚                   â”‚ChatResponse  â”‚
       â”‚ â€¢ cosineSimilarity() â”‚                   â”‚ â€¢ answer     â”‚
       â”‚ â€¢ ema()              â”‚                   â”‚ â€¢ movies[]   â”‚
       â”‚ â€¢ hybrid scoring     â”‚                   â”‚ â€¢ proactive? â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚RecommendationService â”‚
       â”‚ (ENHANCED)           â”‚
       â”‚                      â”‚
       â”‚ score = 0.6*cosine   â”‚
       â”‚       + 0.3*CTR      â”‚
       â”‚       + 0.1*freshnessâ”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Added:
+ User behavior tracking (UserSignal)
+ Semantic personalization (UserProfile + ItemEmbedding)
+ Conversational personality (persona detection)
+ Proactive suggestions (rule-based triggers)
```

---

## ğŸ”„ Data Flow Diagram

### **Scenario 1: User Clicks on Movie (Signal Tracking)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FE  â”‚                                  â”‚  Backend â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜                                  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚                                           â”‚
    â”‚ 1. User clicks movie card                â”‚
    â”‚    (from chatbot suggestion)             â”‚
    â”‚                                           â”‚
    â”‚ 2. POST /api/signals                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚    {                                      â”‚
    â”‚      eventType: "click_movie",            â”‚
    â”‚      movieId: "movie123",                 â”‚
    â”‚      metadata: {source: "chatbot"}        â”‚
    â”‚    }                                      â”‚
    â”‚                                           â”‚
    â”‚                                           â”‚ 3. Save UserSignal
    â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
    â”‚                                           â”‚                  DynamoDB
    â”‚                                           â”‚                  (UserSignal table)
    â”‚                                           â”‚
    â”‚                                           â”‚ 4. Get ItemEmbedding
    â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
    â”‚                                           â”‚                  DynamoDB
    â”‚                                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                                           â”‚  vector[384]
    â”‚                                           â”‚
    â”‚                                           â”‚ 5. Get UserProfile
    â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
    â”‚                                           â”‚                  DynamoDB
    â”‚                                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                                           â”‚  userVector[384]
    â”‚                                           â”‚
    â”‚                                           â”‚ 6. Update UserProfile
    â”‚                                           â”‚    new_vector = EMA(user, item)
    â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
    â”‚                                           â”‚                  DynamoDB
    â”‚                                           â”‚
    â”‚ 7. OK 200                                 â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                           â”‚
```

---

### **Scenario 2: User Asks for Recommendation**

```
â”Œâ”€â”€â”€â”€â”€â”€â”                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FE  â”‚                                  â”‚  Backend â”‚                â”‚ OpenAI â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜                                  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚                                           â”‚                          â”‚
    â”‚ 1. POST /api/ai/chat                     â”‚                          â”‚
    â”‚    {message: "gá»£i Ã½ phim hay"}           â”‚                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
    â”‚                                           â”‚                          â”‚
    â”‚                                           â”‚ 2. Get UserProfile      â”‚
    â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>         â”‚
    â”‚                                           â”‚               DynamoDB   â”‚
    â”‚                                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
    â”‚                                           â”‚ {userVector, topGenres}  â”‚
    â”‚                                           â”‚                          â”‚
    â”‚                                           â”‚ 3. Get ItemEmbeddings    â”‚
    â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>         â”‚
    â”‚                                           â”‚               DynamoDB   â”‚
    â”‚                                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
    â”‚                                           â”‚ [{movieId, vector}...]   â”‚
    â”‚                                           â”‚                          â”‚
    â”‚                                           â”‚ 4. Calculate scores      â”‚
    â”‚                                           â”‚    For each movie:       â”‚
    â”‚                                           â”‚      cos_sim = cosine(u,v)â”‚
    â”‚                                           â”‚      ctr = clicks/impr   â”‚
    â”‚                                           â”‚      fresh = exp(-age/5) â”‚
    â”‚                                           â”‚      score = 0.6*cos +   â”‚
    â”‚                                           â”‚               0.3*ctr +  â”‚
    â”‚                                           â”‚               0.1*fresh  â”‚
    â”‚                                           â”‚                          â”‚
    â”‚                                           â”‚ 5. Sort by score, top 8  â”‚
    â”‚                                           â”‚    candidates = [...]    â”‚
    â”‚                                           â”‚                          â”‚
    â”‚                                           â”‚ 6. Check proactive       â”‚
    â”‚                                           â”‚    opportunities         â”‚
    â”‚                                           â”‚    (e.g., user asked     â”‚
    â”‚                                           â”‚     promo 3 times)       â”‚
    â”‚                                           â”‚                          â”‚
    â”‚                                           â”‚ 7. Build persona context â”‚
    â”‚                                           â”‚    persona = "Fan anime" â”‚
    â”‚                                           â”‚    tone = "energetic"    â”‚
    â”‚                                           â”‚                          â”‚
    â”‚                                           â”‚ 8. POST /chat/completionsâ”‚
    â”‚                                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                           â”‚  {                       â”‚
    â”‚                                           â”‚    model: "gpt-4o-mini", â”‚
    â”‚                                           â”‚    messages: [           â”‚
    â”‚                                           â”‚      {system: persona},  â”‚
    â”‚                                           â”‚      {user: query}       â”‚
    â”‚                                           â”‚    ],                    â”‚
    â”‚                                           â”‚    context: candidates   â”‚
    â”‚                                           â”‚  }                       â”‚
    â”‚                                           â”‚                          â”‚
    â”‚                                           â”‚ 9. Response              â”‚
    â”‚                                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                           â”‚  {answer, suggestions}   â”‚
    â”‚                                           â”‚                          â”‚
    â”‚ 10. ChatResponse                          â”‚                          â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
    â”‚     {                                     â”‚                          â”‚
    â”‚       answer: "MÃ¬nh cÃ³ vÃ i phim...",      â”‚                          â”‚
    â”‚       suggestions: [...],                 â”‚                          â”‚
    â”‚       showSuggestions: true               â”‚                          â”‚
    â”‚     }                                     â”‚                          â”‚
```

---

## ğŸ§® ML Algorithm Visualizations

### **1. User Vector Evolution (EMA)**

```
Timeline: User's movie preferences over time

Day 1: User watches Action movie
userVector = [1.0, 0.0, 0.0, 0.0] (pure Action)

Day 3: User clicks Romance movie
itemVector = [0.0, 1.0, 0.0, 0.0] (pure Romance)
userVector = 0.7*[0.0,1.0,0.0,0.0] + 0.3*[1.0,0.0,0.0,0.0]
           = [0.3, 0.7, 0.0, 0.0] (70% Romance, 30% Action)

Day 5: User clicks Comedy movie
itemVector = [0.0, 0.0, 1.0, 0.0] (pure Comedy)
userVector = 0.7*[0.0,0.0,1.0,0.0] + 0.3*[0.3,0.7,0.0,0.0]
           = [0.09, 0.21, 0.7, 0.0] (70% Comedy, 21% Romance, 9% Action)

Result: User vector shifts gradually toward recent preferences!
```

---

### **2. Cosine Similarity Calculation**

```
Example: Does user like "Naruto"?

User Vector (from profile):
u = [0.8, 0.1, 0.5, ...]  (384 dimensions)
    ^Action ^Romance ^Comedy

Naruto Vector (from ItemEmbedding):
v = [0.9, 0.0, 0.7, ...]  (384 dimensions)
    ^Shounen ^Romance ^Comedy

Cosine Similarity:
cos(Î¸) = (u Â· v) / (||u|| Ã— ||v||)

Dot product: uÂ·v = 0.8*0.9 + 0.1*0.0 + 0.5*0.7 + ...
                 = 0.72 + 0.0 + 0.35 + ... = 85.3

Norms: ||u|| = sqrt(0.8Â² + 0.1Â² + 0.5Â² + ...) = 10.2
       ||v|| = sqrt(0.9Â² + 0.0Â² + 0.7Â² + ...) = 9.8

Result: cos(Î¸) = 85.3 / (10.2 Ã— 9.8) = 0.85

Interpretation: 0.85 is VERY HIGH â†’ User will likely love Naruto!
                (Range: -1 to 1, where 1 = perfect match)
```

---

### **3. Hybrid Scoring Example**

```
Movie: "Attack on Titan"

Component 1: Cosine Similarity
  user_vector vs. AOT_vector = 0.75
  normalized to [0,1]: (0.75+1)/2 = 0.875

Component 2: Personal CTR
  user clicked AOT 2 times in last 10 impressions
  CTR = 2/10 = 0.2

Component 3: Freshness
  AOT released 2013 â†’ age = 2025-2013 = 12 years
  freshness = exp(-12/5) = exp(-2.4) = 0.091

Hybrid Score:
  score = 0.6 * 0.875 + 0.3 * 0.2 + 0.1 * 0.091
        = 0.525 + 0.06 + 0.009
        = 0.594

Rank: 0.594 â†’ Likely in top 3-5 recommendations!
```

---

## ğŸ­ Persona Detection Flowchart

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Get UserProfileâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Check topGenresâ”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                         â”‚       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Contains "Action"â”‚                    â”‚Contains "Romance"â”‚
â”‚    + "Shounen"  â”‚                    â”‚    + "Drama"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                      â”‚
         â–¼                                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Persona: "Fan anime â”‚          â”‚ Persona: "NgÆ°á»i thÃ­châ”‚
    â”‚ hÃ nh Ä‘á»™ng nÄƒng lÆ°á»£ngâ”‚          â”‚ phim tÃ¬nh cáº£m cáº£m    â”‚
    â”‚ cao (Shounen)"      â”‚          â”‚ Ä‘á»™ng"                â”‚
    â”‚                     â”‚          â”‚                      â”‚
    â”‚ Tone: "nhiá»‡t tÃ¬nh,  â”‚          â”‚ Tone: "nháº¹ nhÃ ng,    â”‚
    â”‚ nÄƒng Ä‘á»™ng"          â”‚          â”‚ sÃ¢u láº¯ng"            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Inject into system   â”‚
              â”‚ prompt:              â”‚
              â”‚ "Báº¡n lÃ  trá»£ lÃ½ vá»›i   â”‚
              â”‚ phong cÃ¡ch {tone}.   â”‚
              â”‚ Persona: {persona}"  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Proactive Suggestion Decision Tree

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚Get recent      â”‚
                    â”‚signals (7 days)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Asked "promo"  â”‚    â”‚Dwell time on  â”‚    â”‚Watched 3+     â”‚
â”‚â‰¥2 times?      â”‚    â”‚detail page    â”‚    â”‚episodes of    â”‚
â”‚               â”‚    â”‚>30s?          â”‚    â”‚same series?   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚       â”‚            â”‚       â”‚            â”‚       â”‚
   Yes     No           Yes     No           Yes     No
    â”‚       â”‚            â”‚       â”‚            â”‚       â”‚
    â–¼       â”‚            â–¼       â”‚            â–¼       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚Push     â”‚ â”‚   â”‚Suggest trailerâ”‚ â”‚   â”‚Suggest next  â”‚ â”‚
â”‚voucher  â”‚ â”‚   â”‚"Muá»‘n xem     â”‚ â”‚   â”‚season "Muá»‘n  â”‚ â”‚
â”‚"CÃ³ mÃ£   â”‚ â”‚   â”‚trailer?"     â”‚ â”‚   â”‚xem tiáº¿p?"    â”‚ â”‚
â”‚giáº£m 30%"â”‚ â”‚   â”‚              â”‚ â”‚   â”‚              â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
            â”‚                    â”‚                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚No proactive        â”‚
                    â”‚suggestion this timeâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Performance Comparison Chart

```
Metric: CTR@5 (Click-through Rate in Top 5)

Before (Rule-based):
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 8%

After (ML-enhanced):
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 15%

Improvement: +87.5%

---

Metric: Watch Time per Session

Before:
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% (baseline)

After:
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 110%

Improvement: +10%

---

Metric: User Engagement (messages per session)

Before:
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 3.0 msg

After:
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 4.2 msg

Improvement: +40%

---

Metric: Cost per 1K Queries

Before:
[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] $0.60

After:
[â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] $0.50

Improvement: -17% (more efficient!)
```

---

## ğŸ—„ï¸ Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserProfile (DynamoDB Table)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ userId (PK)          : String                       â”‚
â”‚ userVector           : List<Float> (384-dim)        â”‚
â”‚ topGenres            : List<String> (max 5)         â”‚
â”‚ priceTier            : String ("FREE"|"PREMIUM")    â”‚
â”‚ lastIntents          : List<String> (max 5)         â”‚
â”‚ genreCount           : Map<String,Integer>          â”‚
â”‚ preferredTone        : String                       â”‚
â”‚ totalInteractions    : Long                         â”‚
â”‚ lastUpdated          : Long (timestamp)             â”‚
â”‚ ttl                  : Long (90 days)               â”‚
â”‚ personalizationEnabled : Boolean (default: true)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ItemEmbedding (DynamoDB Table)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ movieId (PK)         : String                       â”‚
â”‚ vector               : List<Float> (384-dim)        â”‚
â”‚ genres               : List<String>                 â”‚
â”‚ tags                 : List<String>                 â”‚
â”‚ releaseYear          : Integer                      â”‚
â”‚ embeddingVersion     : String ("v1")                â”‚
â”‚ lastUpdated          : Long (timestamp)             â”‚
â”‚ ttl                  : Long (1 year)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserSignal (DynamoDB Table)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ userId (PK)          : String                       â”‚
â”‚ timestamp (SK)       : Long                         â”‚
â”‚ eventType            : String                       â”‚
â”‚                        ("click_movie"|"view_engaged"â”‚
â”‚                        |"add_wishlist"|"click_like")â”‚
â”‚ movieId              : String                       â”‚
â”‚ movieTitle           : String (denormalized)        â”‚
â”‚ metadata             : Map<String,Object>           â”‚
â”‚                        {source, watchTime, query}   â”‚
â”‚ ttl                  : Long (90 days)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relationships:
- UserProfile â†(1:N)â†’ UserSignal (one user has many signals)
- ItemEmbedding â†(1:N)â†’ UserSignal (one movie has many signals)
- UserProfile.userVector is derived from clicked ItemEmbedding.vectors
```

---

## ğŸš€ Deployment Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Week 1    â”‚â”€â”€â”€â–¶â”‚  Week 2    â”‚â”€â”€â”€â–¶â”‚  Week 3    â”‚â”€â”€â”€â–¶â”‚  Week 4    â”‚
â”‚Infrastructureâ”‚    â”‚ ML Featuresâ”‚    â”‚Enhancementsâ”‚    â”‚ Production â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                  â”‚                  â”‚                  â”‚
      â–¼                  â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â€¢ Create  â”‚      â”‚â€¢ Generateâ”‚      â”‚â€¢ Persona â”‚      â”‚â€¢ A/B testâ”‚
â”‚  tables  â”‚      â”‚  embed   â”‚      â”‚  detect  â”‚      â”‚â€¢ Monitor â”‚
â”‚â€¢ Repos   â”‚      â”‚â€¢ Hybrid  â”‚      â”‚â€¢ Proactiveâ”‚      â”‚â€¢ Deploy  â”‚
â”‚â€¢ Signal  â”‚      â”‚  ranking â”‚      â”‚  suggest â”‚      â”‚          â”‚
â”‚  endpointâ”‚      â”‚â€¢ Nightly â”‚      â”‚â€¢ Update  â”‚      â”‚          â”‚
â”‚â€¢ FE trackâ”‚      â”‚  refresh â”‚      â”‚  AiServiceâ”‚      â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                  â”‚                  â”‚                  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Result: 9.8-10.0/10  â”‚
                    â”‚ World-class Chatbot! â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Legend:**
- PK = Partition Key
- SK = Sort Key (Range Key)
- TTL = Time To Live (auto-delete after expiration)
- EMA = Exponential Moving Average
- CTR = Click-Through Rate

---

**For detailed implementation, see:**
- `ML_ROADMAP_ANALYSIS.md` - Complete technical design
- `IMPLEMENTATION_CHECKLIST.md` - Step-by-step guide
- `README_ML_PACKAGE.md` - Package overview

